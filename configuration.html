<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2019-10-08 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Data Distribution API for VIVO &#x2013; Configuring the API</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                data-distribution-api-site
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
                <div class="xleft">
        <span id="publishDate">Last Published: 2019-10-08</span>
                  &nbsp;| <span id="projectVersion">Version: 1.1.1</span>
                      </div>
            <div class="xright">      
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
                                <h5>Overview</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="motivation.html" title="Why another API?">Why another API?</a>
            </li>
                  <li class="none">
                          <a href="structure.html" title="How does it work?">How does it work?</a>
            </li>
                  <li class="none">
                          <a href="install_vivo_1_11.html" title="Install in VIVO 1.11">Install in VIVO 1.11</a>
            </li>
                  <li class="none">
                          <a href="install_vivo_1_10.html" title="Install in VIVO 1.10">Install in VIVO 1.10</a>
            </li>
                  <li class="none">
                          <a href="install_vivo_1_9.html" title="Install in VIVO 1.9">Install in VIVO 1.9</a>
            </li>
                  <li class="none">
                          <a href="install_vivo_1_8.html" title="Install in VIVO 1.8">Install in VIVO 1.8</a>
            </li>
                  <li class="none">
            <strong>Configuration</strong>
          </li>
                  <li class="none">
                          <a href="catalog.html" title="Implementations">Implementations</a>
            </li>
                  <li class="none">
                          <a href="cors.html" title="Cross-site distributions">Cross-site distributions</a>
            </li>
                  <li class="none">
                          <a href="apidocs/index.html" title="Javadoc">Javadoc</a>
            </li>
                  <li class="none">
                          <a href="release_notes.html" title="Release notes">Release notes</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                      <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                 
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>Configuring the API</h1>
<p>The <tt>DataDistributor</tt> instances used by the API are configured in the triples of the Vitro display model. When the API controller receives a request, it looks in the display model for the description of a <tt>DataDistributor</tt> with the correct action name.</p>
<p>The controller uses that description to create a Java instance which will service the request. The Java class of the instance is taken from the RDF, and any properties that should be provided to the newly-created instance.</p>
<p>When the instance has been created and initialized, it will provide the contents and type of the HTTP response.</p>
<p>The most common way to create such triples is to add one or more files of RDF to the <tt>rdf/display/everytime</tt> folder in the Vitro home directory.</p>
<div class="section">
<h2><a name="Configuring_Hello_World"></a>Configuring &#x201c;Hello, World&#x201d;</h2>
<p>Let&#x2019;s review the configuration that was used to test the API: the &#x201c;Hello, World&#x201d; distributor.</p>
<p>In that case, we created a file of RDF in Turtle format, and put it in VIVO&#x2019;s <tt>rdf/display/everytime</tt> folder.</p>

<div class="source">
<div class="source">
<pre>@prefix : &lt;http://vitro.mannlib.cornell.edu/ns/vitro/ApplicationSetup#&gt; .
  
:data_distributor_hello
    a   &lt;java:edu.cornell.library.scholars.webapp.controller.api.distribute.DataDistributor&gt; ,
        &lt;java:edu.cornell.library.scholars.webapp.controller.api.distribute.examples.HelloDistributor&gt; ;
    :actionName &quot;hello&quot; .
</pre></div></div>
<div class="section">
<h3><a name="What_does_this_configuration_say"></a>What does this configuration say?</h3>

<ul>
  
<li>The <tt>@prefix</tt> line establishes the default namespace. By convention, the properties on a <tt>DataDistributor</tt> instance will use this namespace. For example, we may say that every description of a <tt>DataDistributor</tt> must include a data property for <tt>:actionName</tt>, but this is an abbreviated notation for the actual requirement: a data property for <tt>&lt;http://vitro.mannlib.cornell.edu/ns/vitro/ApplicationSetup#actionName&gt;</tt>.</li>
  
<li>The description must have a URI, but the URI is arbitrary. It is common to place the URI in the default namespace, simply for brevity, but it is not required.
  
<ul>
    
<li>This might seem like the perfect place for a blank URI. However, the API controller does not deal well with blank URIs.</li>
  </ul></li>
  
<li>Two type statements are included.
  
<ul>
    
<li>The first says that this URI represents a <tt>DataDistributor</tt>, but that is an abstract class, and can&#x2019;t be instantiated.</li>
    
<li>The second specifies a concrete class for the instance.</li>
    
<li>Both are necessary.</li>
  </ul></li>
  
<li>A <tt>DataDistributor</tt> description is useless without an <tt>:actionName</tt> property.
  
<ul>
    
<li>When a request comes to the API controller, it will look for a  <tt>DataDistributor</tt> whose  <tt>:actionName</tt> property matches the last part of the request path.</li>
    
<li>A request of <tt>http://localhost:8080/vivo/api/dataRequest/hello</tt> would match the description shown above.</li>
  </ul></li>
</ul></div></div>
<div class="section">
<h2><a name="A_more_ambitious_example"></a>A more ambitious example</h2>
<p>The configuration of a <tt>DataDistributor</tt> may also involve the configuration of related object. In this example, we configure a <tt>DataDistributor</tt> instance that executes a SPARQL SELECT query against an RDF graph. That graph is the result of queries by two <tt>GraphBuilder</tt> instances. Each <tt>GraphBuilder</tt> runs a query against the VIVO content models.</p>
<p>All of this is accomplished through the configuration.</p>

<div class="source">
<div class="source">
<pre>@prefix : &lt;http://vitro.mannlib.cornell.edu/ns/vitro/ApplicationSetup#&gt; .
  
:ambitious
    a   &lt;java:edu.cornell.library.scholars.webapp.controller.api.distribute.DataDistributor&gt; ,
        &lt;java:edu.cornell.library.scholars.webapp.controller.api.distribute.rdf.SelectFromGraphDistributor&gt; ;
    :actionName &quot;2graphs&quot; ;
    :graphBuilder :ambitious_graph1 ,
                  :ambitious_graph2 ;
    :query &quot;&quot;&quot;
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
      SELECT ?label
      WHERE {
        ?s rdfs:label ?label .
      }
    &quot;&quot;&quot; .
    
:ambitious_graph1
    a   &lt;java:edu.cornell.library.scholars.webapp.controller.api.distribute.rdf.graphbuilder.GraphBuilder&gt; ,
        &lt;java:edu.cornell.library.scholars.webapp.controller.api.distribute.rdf.graphbuilder.ConstructQueryGraphBuilder&gt; ;
    :constructQuery &quot;&quot;&quot;
        PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
        PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;
        CONSTRUCT {
          ?concept rdfs:label ?label .
        } WHERE {
          ?concept a skos:Concept .
          ?concept rdfs:label ?label .
        }
    &quot;&quot;&quot; .

:ambitious_graph2
    a   &lt;java:edu.cornell.library.scholars.webapp.controller.api.distribute.rdf.graphbuilder.GraphBuilder&gt; ,
        &lt;java:edu.cornell.library.scholars.webapp.controller.api.distribute.rdf.graphbuilder.ConstructQueryGraphBuilder&gt; ;
    :constructQuery &quot;&quot;&quot;
        PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
        PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;
        CONSTRUCT {
          ?person rdfs:label ?label .
        } WHERE {
          ?person a foaf:Person .
          ?person rdfs:label ?label .
        }
    &quot;&quot;&quot; .
</pre></div></div>
<div class="section">
<h3><a name="What_does_this_configuration_say"></a>What does this configuration say?</h3>

<ul>
  
<li>The <tt>@prefix</tt> line is the same as in the previous example.</li>
  
<li>Again, we describe a <tt>DataDistributor</tt> instance. This one has a concrete class of <tt>SelectFromGraphDistributor</tt>. It will run two graph builders, merge their results into a single graph, and execute a SPARQL SELECT query against that merged graph.
  
<ul>
    
<li>As in the previous example, the <tt>DataDistributor</tt> needs a data property for <tt>:actionName</tt>, to match an HTTP request.</li>
    
<li>The <tt>SelectFromGraphDistributor</tt> instance requires one or more object properties for <tt>:graphBuilder</tt>. The values are URIs which describe <tt>GraphBuilder</tt> instances, elsewhere in the configuration.</li>
    
<li>The instance also requires a SPARQL SELECT query, to execute against the results obtained from the <tt>GraphBuilder</tt> instance(s).</li>
  </ul></li>
  
<li>The next section describes a <tt>GraphBuilder</tt> instance.
  
<ul>
    
<li>The URI is arbitrary, except that it matches the reference made by the <tt>SelectFromGraphDistributor</tt>.</li>
    
<li>There are two type statements:
    
<ul>
      
<li>The first says that this represents a <tt>GraphBuilder</tt>, as the <tt>SelectFromGraphDistributor</tt> requires. This is not sufficient to create the instance, since <tt>GraphBuilder</tt> is an abstract class.</li>
      
<li>The second specifies the concrete class of the instance.</li>
    </ul></li>
    
<li>The <tt>ConstructQueryGraphBuilder</tt> requires a data property for <tt>:constructQuery</tt>.
    
<ul>
      
<li>This query will be run against the VIVO content models, producing an RDF graph as a result.</li>
    </ul></li>
  </ul></li>
  
<li>The final section describes another <tt>GraphBuilder</tt> instance.</li>
</ul></div></div>
<div class="section">
<h2><a name="Creating_the_configuration_files"></a>Creating the configuration files</h2>
<p>The configuration is based on triples in the display model of VIVO&#x2019;s configuration triple-store. These triples are usually created by placing one or more files in <tt>{VIVO}/home/src/main/resources/rdf/display/everytime</tt> and running the build script.</p>
<p>RDF files in this folder may use any of these formats:</p>

<table border="0" class="bodyTable">
  <thead>
    
<tr class="a">
      
<th>Format </th>
      
<th>file extension</th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td>RDF/XML </td>
      
<td><tt>.rdf</tt></td>
    </tr>
    
<tr class="a">
      
<td>N-triples </td>
      
<td><tt>.nt</tt></td>
    </tr>
    
<tr class="b">
      
<td>Turtle </td>
      
<td><tt>.ttl</tt></td>
    </tr>
    
<tr class="a">
      
<td>N3 </td>
      
<td><tt>.n3</tt></td>
    </tr>
  </tbody>
</table>
<p>File names are arbitrary (except for the extensions). Chose names that are meaningful.</p>
<p>The configuration triples may all be in a single file, or may be split among several files. Use whatever scheme you feel is clear and maintainable.</p>
<div class="section">
<h3><a name="Other_ways_to_create_configuration_triples"></a>Other ways to create configuration triples</h3>
<p>Some people may prefer to place the configuration file in the <tt>rdf/display/everytime</tt> folder of VIVO&#x2019;s home directory, where it will be picked up at runtime. Be aware, however, that any such files would be overwritten by the next build.</p>
<p>It would also be possible to ingest the triples into VIVO, using the interactive <b>Site Administration</b> tools to <b>Manage Jena Models</b>.</p></div></div>
<div class="section">
<h2><a name="RDF_syntax_errors"></a>RDF syntax errors</h2>
<p>A systax error in a configuration file will cause VIVO to ignore that file. This may go unnoticed because it does not preven VIVO from starting, nor does VIVO display any warning message in the browser.</p>
<p>To find RDF syntax errors, you will need to inspect VIVO&#x2019;s log file, <tt>vivo.all.log</tt>. Here is an example of an error in the log file:</p>

<div class="source">
<div class="source">
<pre>2017-08-17 13:29:06,649 WARN  [RDFFilesLoader] Could not load file '/vivo/instance/home/rdf/display/everytime/HelloDistributorConfig.ttl' as TURTLE. Check that it contains valid data.
org.apache.jena.riot.RiotException: [line: 1, col: 77] Out of place: [DOT]
</pre></div></div>
<p>In this case, the leading <tt>@</tt> was inadvertently removed from the <tt>prefix</tt> statement.</p></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2019.
          All rights reserved.    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
